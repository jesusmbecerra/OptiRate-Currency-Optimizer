<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OptiRate - Bectronix</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; background: #eef2f3; color: #333; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px; max-width: 400px; margin-left: auto; margin-right: auto; }
        h2 { text-align: center; color: #2c3e50; font-size: 1.2rem; }
        .grid-tasas { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .campo { display: flex; flex-direction: column; margin-bottom: 10px; }
        label { font-size: 0.75rem; font-weight: bold; margin-bottom: 4px; color: #666; }
        input { padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 1rem; }
        button { background: #27ae60; color: white; border: none; padding: 12px; width: 100%; border-radius: 6px; cursor: pointer; font-size: 1rem; font-weight: bold; transition: 0.3s; }
        button:hover { background: #219150; }
        hr { border: 0; border-top: 1px solid #eee; margin: 20px 0; }
    </style>
</head>
<body>

    <div class="card">
        <h2>OptiRate - Bectronix üìä</h2>
        <p style="font-size: 0.8rem; text-align: center;">Configura tus tasas de referencia (Mi Casa de Cambio)</p>
        
        <div class="grid-tasas">
            <div class="campo">
                <label>Bs/USD (BCV)</label>
                <input type="number" id="tasa_bcv" step="0.01">
            </div>
            <div class="campo">
                <label>Bs/USDT (Binance)</label>
                <input type="number" id="tasa_binance" step="0.01">
            </div>
            <div class="campo">
                <label>USD/COP (Venta)</label>
                <input type="number" id="tasa_usd_cop_v">
            </div>
            <div class="campo">
                <label>COP/USD (Compra)</label>
                <input type="number" id="tasa_cop_usd_c">
            </div>
            <div class="campo">
                <label>COP/Bs (Venta)</label>
                <input type="number" id="tasa_cop_bs_v">
            </div>
            <div class="campo">
                <label>Bs/COP (Compra)</label>
                <input type="number" id="tasa_bs_cop_c">
            </div>
            <div class="campo">
                <label>USDT/COP (Binance)</label>
                <input type="number" id="tasa_usdt_cop">
            </div>
        </div>

        <button onclick="guardarTasas()">üíæ Guardar Tasas</button>
    </div>
<div class="card" id="calculadora">
    <h2>üí∞ Ofertas del Vendedor</h2>
    <p style="font-size: 0.8rem; color: #666;">Ingresa los precios que te dio el comercio:</p>
    
    <div class="grid-tasas">
        <div class="campo">
            <label>Precio en USD ($)</label>
            <input type="number" id="off_usd" placeholder="Ej: 10">
        </div>
        <div class="campo">
            <label>Precio en USD (a tasa BCV)</label>
            <input type="number" id="off_bcv" placeholder="Ej: 15">
        </div>
        <div class="campo">
            <label>Precio en USD (a Binance o Euro)</label>
            <input type="number" id="off_binance" placeholder="Ej: 12">
        </div>
        <div class="campo">
            <label>Precio total en COP</label>
            <input type="number" id="off_cop" placeholder="Ej: 40000">
        </div>
    </div>

    <hr>
    <div class="campo">
        <label>¬øQu√© moneda tienes t√∫ para pagar?</label>
        <select id="tengo_moneda">
            <option value="usd">D√≥lares Efectivo</option>
            <option value="bs">Bol√≠vares</option>
            <option value="cop">Pesos Colombianos</option>
            <option value="usdt">D√≥lar Digital (Binance)</option>
        </select>
    </div>

    <button onclick="compararTodo()" style="background: #e67e22;">üî• ¬øCu√°l me conviene m√°s?</button>

    <div id="resultado_final" style="margin-top: 20px;"></div>
</div>
    </div>

    <script>
        
  const valoresIniciales = {
    tasa_bcv: 330.37,
    tasa_binance: 584,
    tasa_usd_cop_v: 3710,
    tasa_cop_usd_c: 3750,
    tasa_cop_bs_v: 6.6,
    tasa_bs_cop_c: 7,
    tasa_usdt_cop: 3600
};  


   // 1. Definici√≥n de IDs de los campos de tasas
const camposTasas = [
    'tasa_bcv', 'tasa_binance', 'tasa_usd_cop_v', 
    'tasa_cop_usd_c', 'tasa_cop_bs_v', 'tasa_bs_cop_c', 'tasa_usdt_cop'
];

function cargarDatos() {
        camposTasas.forEach(id => {
            const guardado = localStorage.getItem(id);
            
            if (guardado !== null) {
                // Si existe en la memoria del navegador, √∫salo
                document.getElementById(id).value = guardado;
            } else {
                // Si borraste el historial, usa el valor inicial del objeto de arriba
                document.getElementById(id).value = valoresIniciales[id];
            }
        });
    }


function compararTodo() {
    // 1. Tus tasas personales (Aseg√∫rate de capturar TODAS las que usaremos en la recomendaci√≥n)
    const misTasas = {
        bcv: parseFloat(document.getElementById('tasa_bcv').value) || 0,
        binance: parseFloat(document.getElementById('tasa_binance').value) || 0,
        usd_a_cop: parseFloat(document.getElementById('tasa_usd_cop_v').value) || 0,
        cop_a_usd: parseFloat(document.getElementById('tasa_cop_usd_c').value) || 0,
        cop_a_bs: parseFloat(document.getElementById('tasa_cop_bs_v').value) || 0 // Agregada
    };

    // 2. Las ofertas del vendedor
    const ofertas = {
        efectivo: parseFloat(document.getElementById('off_usd').value) || 0,
        bcv: parseFloat(document.getElementById('off_bcv').value) || 0,
        binance: parseFloat(document.getElementById('off_binance').value) || 0,
        cop: parseFloat(document.getElementById('off_cop').value) || 0
    };

    const miMoneda = document.getElementById('tengo_moneda').value;
    let analisis = [];

    // 3. L√≥gica de conversi√≥n a "D√≥lares Reales"
    if(ofertas.efectivo > 0) {
        analisis.push({ nombre: "D√≥lar Efectivo", costo: ofertas.efectivo });
    }

    if(ofertas.bcv > 0) {
        // Tu costo real: lo que te cost√≥ a TI conseguir esos bol√≠vares (usando tasa Binance/Paralelo)
        let montoEnBs = ofertas.bcv * misTasas.bcv; 
        let costoRealUSD = montoEnBs / misTasas.binance; 
        analisis.push({ nombre: "Bs (Tasa BCV)", costo: costoRealUSD });
    }

    if(ofertas.binance > 0) {
        analisis.push({ nombre: "D√≥lar Binance", costo: ofertas.binance });
    }

    if(ofertas.cop > 0) {
        let costoRealUSD = ofertas.cop / misTasas.usd_a_cop; 
        analisis.push({ nombre: "Pesos COP", costo: costoRealUSD });
    }

    // Si no hay datos, salir
    if (analisis.length === 0) {
        document.getElementById('resultado_final').innerHTML = "‚ö†Ô∏è Ingresa al menos un precio de oferta.";
        return;
    }

    // 4. Ordenar ranking
    analisis.sort((a, b) => a.costo - b.costo);

    // 5. Construir HTML de Ranking
    let htmlResultado = "<h3>Ranking de Conveniencia:</h3>";
    analisis.forEach((item, index) => {
        const color = index === 0 ? "green" : "black";
        const estrella = index === 0 ? "‚≠ê MEJOR OPCI√ìN: " : "";
        htmlResultado += `<p style="color: ${color}">${estrella}<b>${item.nombre}</b>: Te sale en $${item.costo.toFixed(2)} reales</p>`;
    });

    // --- AN√ÅLISIS DE TASAS DEL VENDEDOR ---
    let htmlTasasVendedor = "<hr><h4>Tasas Impl√≠citas del Vendedor:</h4>";
    if (ofertas.cop > 0 && ofertas.efectivo > 0) {
        let tasaVendedorCOP = ofertas.cop / ofertas.efectivo;
        let esMala = tasaVendedorCOP > misTasas.cop_a_usd; 
        let color = esMala ? "red" : "green";
        htmlTasasVendedor += `<p style="color: ${color}">Tasa COP vendedor: <b>${tasaVendedorCOP.toFixed(0)}</b> (Tu Denver: ${misTasas.cop_a_usd})</p>`;
    }

    // --- L√ìGICA DE RECOMENDACI√ìN DE RUTA ---
    const mejorOpcion = analisis[0]; 
    let recomendacionRuta = "<div style='background:#fff3cd; padding:15px; border-radius:10px; margin-top:15px; border:1px solid #ffeeba;'>";
    recomendacionRuta += "<h4>üí° Estrategia Sugerida:</h4>";

    // CASO A: Ya tienes la moneda ideal
    if (
        (miMoneda === 'usd' && mejorOpcion.nombre === "D√≥lar Efectivo") ||
        (miMoneda === 'bs' && mejorOpcion.nombre.includes("Bs")) ||
        (miMoneda === 'cop' && mejorOpcion.nombre === "Pesos COP") ||
        (miMoneda === 'usdt' && mejorOpcion.nombre === "D√≥lar Binance")
    ) {
        recomendacionRuta += "<p>‚úÖ <b>Acci√≥n directa:</b> Ya tienes la moneda ideal. Paga directamente.</p>";
    } 
    
    // CASO B: Tienes USD pero la mejor opci√≥n es Bs (BCV) - Triangulaci√≥n
    else if (miMoneda === 'usd' && mejorOpcion.nombre === "Bs (Tasa BCV)") {
        recomendacionRuta += `
            <p>1. Cambia tus USD a Pesos (Denver) a <b>${misTasas.usd_a_cop}</b>.</p>
            <p>2. Cambia esos Pesos a Bol√≠vares a <b>${misTasas.cop_a_bs}</b>.</p>
            <p>3. Paga en Bol√≠vares por transferencia o punto.</p>`;
    }

    // CASO C: Tienes COP pero la mejor opci√≥n es USD Efectivo
    else if (miMoneda === 'cop' && mejorOpcion.nombre === "D√≥lar Efectivo") {
        recomendacionRuta += `
            <p>1. No pagues en Pesos directamente.</p>
            <p>2. Usa tus pesos para comprar USD en Denver a <b>${misTasas.cop_a_usd}</b>.</p>
            <p>3. Paga con el billete de USD.</p>`;
    }

    // CASO D: Tienes Bol√≠vares pero la mejor opci√≥n es COP
    else if (miMoneda === 'bs' && mejorOpcion.nombre === "Pesos COP") {
        recomendacionRuta += `
            <p>1. El vendedor tiene muy buena tasa en Pesos.</p>
            <p>2. Cambia tus Bs a Pesos (Denver/Calle) y paga en COP.</p>`;
    }
    
    else {
        recomendacionRuta += "<p>Compara el precio obtenido con tu disponibilidad actual para decidir el cambio.</p>";
    }

    recomendacionRuta += "</div>";

    // Unimos todo al final
    document.getElementById('resultado_final').innerHTML = htmlResultado + recomendacionRuta + htmlTasasVendedor;
}

// 3. Guardar datos manualmente
function guardarTasas() {
    camposTasas.forEach(id => {
        localStorage.setItem(id, document.getElementById(id).value);
    });
    alert("‚úÖ Tasas actualizadas en tu bolsillo digital.");
}



// 4. EL MOTOR DE C√ÅLCULO (Aqu√≠ ocurre la magia)
function calcularConveniencia() {
    // Datos de la oferta del vendedor
    const montoVendedor = parseFloat(document.getElementById('monto_oferta').value);
    const monedaOferta = document.getElementById('moneda_oferta').value;
    
    // Tus tasas personales
    const tasas = {
        bcv: parseFloat(document.getElementById('tasa_bcv').value) || 1,
        binance: parseFloat(document.getElementById('tasa_binance').value) || 1,
        usd_cop: parseFloat(document.getElementById('tasa_usd_cop_v').value) || 1,
        cop_usd: parseFloat(document.getElementById('tasa_cop_usd_c').value) || 1
    };

    if (!montoVendedor) {
        document.getElementById('resultado').innerHTML = "‚ö†Ô∏è Ingresa un precio";
        return;
    }

    let equivalenteUSD = 0;

    // Convertimos lo que pide el vendedor a "D√≥lar Efectivo" (tu base de comparaci√≥n)
    switch (monedaOferta) {
        case 'usd': 
            equivalenteUSD = montoVendedor; 
            break;
        case 'bs_bcv': 
            equivalenteUSD = montoVendedor / tasas.bcv; 
            break;
        case 'bs_binance': 
            equivalenteUSD = montoVendedor / tasas.binance; 
            break;
        case 'cop': 
            // Si el vendedor te pide COP, calculamos cu√°ntos USD te cuesta conseguir esos COP
            equivalenteUSD = montoVendedor / tasas.usd_cop; 
            break;
    }

    // Veredicto
    const divResultado = document.getElementById('resultado');
    divResultado.innerHTML = `
        <div style="background: #d4edda; padding: 15px; border-radius: 8px; border: 1px solid #c3e6cb;">
            <p style="margin: 0; color: #155724;">Costo real para ti:</p>
            <h3 style="margin: 5px 0;">$${equivalenteUSD.toFixed(2)} USD</h3>
            <p style="font-size: 0.8rem; color: #666;">
                Comparado con el precio en efectivo, aqu√≠ sabes si est√°s pagando de m√°s.
            </p>
        </div>
    `;
}

window.onload = cargarDatos;
    </script>
</body>
</html>